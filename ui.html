<!DOCTYPE html>
<title>Magic: The Gathering Price Fetcher</title>
<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/combo?3.3.0/build/cssfonts/fonts-min.css&3.3.0/build/cssreset/reset-min.css&3.3.0/build/cssbase/base-min.css">
<link rel="stylesheet" type="text/css" href="./css/style.css">
<h1>Magic: The Gathering Price Fetcher</h1>

<form>
    <label>Set: <input id="setNameInput" type="text" /></label> 
    <label>Card: <input id="cardNameInput" type="text" /></label>
    <label>Count: <input id="countInput" type="text" size="4" value="1" /></label>
</form>

<script src="http://yui.yahooapis.com/3.4.0pr2/build/yui/yui-min.js"></script>
<script src="./lib/mtg_prices.js"></script>
<script>
YUI().use("mtg-prices", "autocomplete-plugin", "autocomplete-highlighters", "autocomplete-filters", function(Y){
    //localStorage.clear();
    var setNames = new Y.MTG.SetNames();
    var cardSet = new Y.MTG.Set({id: "Revised Edition"});
    var setNameInput = Y.one("#setNameInput");
    var cardNameInput = Y.one("#cardNameInput");
    
    setNames.load(function(err, response){
        if (!err) {
            setNameInput.plug(Y.Plugin.AutoComplete, {
                resultHighlighter: "phraseMatch",
                resultFilters: "phraseMatch",
                source: setNames.get("data")
            });
        }
    });

    cardSet.load(function(err, response) {
        if (!err) {
            cardNameInput.plug(Y.Plugin.AutoComplete, {
                resultHighlighter: "phraseMatch",
                resultFilters: "phraseMatch",
                source: Y.Object.keys(cardSet.get("data"))
            });
        }
    });
    
    setNameInput.on("change", function() {
        Y.log("Changed!");
        // Need a ModelList to hold CardSets
        // Is the value of setNameInput contained in setNames?
        //  - if not, 
        //      - this is an invalid set (or you need to re-sync remotely)
        //      - set an error message
        //      - set some error flag so that other elements on the page respond appropriately
        // Is the value of setNameInput in the ModelList? 
        //  - if so, set the cardNameInput AutoComplete source to that card set's data object
        //  - if not,
        //      - set a "loading data" message
        //      - create a new CardSet and add it to the ModelList
        //      - load the data remotely
        //      - eliminate the "loading data message"
    })
});
</script>